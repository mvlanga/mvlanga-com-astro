---
import { getCollection, render } from "astro:content";
import BlogCommentForm from "@/components/blog/BlogCommentForm.astro";
import BlogComments from "@/components/blog/BlogComments.astro";
import { ViewCounter } from "@/components/blog/ViewCounter";
import { PlayfulDivider } from "@/components/common/PlayfulDivider";
import Prose from "@/components/common/Prose.astro";
import Skeleton from "@/components/common/Skeleton.astro";
import Layout from "@/layouts/layout.astro";

export async function getStaticPaths() {
	const isProduction = import.meta.env.PROD;

	const blogPosts = await getCollection("blogPosts", ({ data }) => {
		return isProduction
			? data.draft === undefined || data.draft === false
			: true;
	});

	return blogPosts.map((post) => ({
		params: { id: post.id },
		props: { post },
	}));
}

const { post } = Astro.props;

const { Content } = await render(post);
const { title, description, tags, createdAt } = post.data;
---

<title slot="head">{title} ‚Äî Moriz von Langa</title>
<meta slot="head" name="description" content={description}/>

<Layout className="container gap-32" footerType="rating">
    <article class="max-w-prose mx-auto flex flex-col gap-16">
        <section>
            <h1 class="mb-8 text-3xl font-bold leading-snug">
                {title}
            </h1>
            <p class="mb-4">
                {description}
            </p>
        </section>

        <section class="flex flex-col gap-4">
            <div class="flex flex-wrap justify-between gap-4 text-neutral-500">
                <span>{tags.map((tag) => `#${tag}`).join(", ")}</span>

                <div class="flex flex-wrap gap-4">
                    <ViewCounter client:idle id={post.id}>
                        <Skeleton slot="fallback" className="w-[8ch]"/>
                    </ViewCounter>
                    <p>{createdAt.toLocaleDateString("en-US")}</p>
                </div>
            </div>
            <PlayfulDivider client:only="react">
                <hr slot="fallback" class="border-neutral-800"/>
            </PlayfulDivider>
        </section>

        <Prose variant="blog">
            <Content/>
        </Prose>
    </article>

    <!--<section class="grid gap-8 justify-center text-center">
        <h2 class="text-3xl">Did you like it?</h2>

        <div class="flex flex-wrap justify-center gap-2">
            <button class="inline-flex rounded-3xl gap-2 px-8 py-4 text-white bg-neutral-900">
                <span class="text-xl">üî•</span>
                <span>5</span>
            </button>
            <button class="inline-flex rounded-3xl gap-2 px-8 py-4 text-white bg-neutral-900">
                <span class="text-xl">‚ù§Ô∏è</span>
            </button>
            <button class="inline-flex rounded-3xl gap-2 px-8 py-4 text-white bg-neutral-900">
                <span class="text-xl">üò¢Ô∏è</span>
                <span>2</span>
            </button>
        </div>
    </section>-->

    <!--<section class="grid gap-16">
        <h2 class="text-4xl">Comments</h2>

        <PlayfulDivider client:only="react">
            <hr slot="fallback" class="border-neutral-800"/>
        </PlayfulDivider>

        <div class="grid grid-cols-3 gap-8">
            <div class="col-span-2">
                <BlogComments server:defer blogPostSlug={post.id}>
                    <div class="flex flex-col gap-4" slot="fallback">
                        {
                            Array.from(
                                {
                                    length: Math.floor(Math.random() * 4) + 1
                                }
                            )
                                .map(() => (
                                        <div class="flex flex-col gap-2 bg-neutral-900 rounded-xl p-6">
                                            <Skeleton className="w-[14ch]"/>
                                            <Skeleton/>
                                            <Skeleton className="w-[10ch]"/>
                                        </div>
                                ))}
                    </div>
                </BlogComments>
            </div>
            <div class="col-span-1">
                <BlogCommentForm blogPostSlug={post.id}/>
            </div>
        </div>
    </section>-->
</Layout>